<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Language ISL Announcement</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            background-color: #000; 
            color: #fff; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            overflow: hidden; 
        }
        .main-content { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }
        .video-container { 
            width: 80%; 
            max-width: 960px; 
            aspect-ratio: 16 / 9; 
            background-color: #111; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        .ticker-wrap { 
            position: fixed; 
            bottom: 0; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 1200px; 
            background-color: #1a1a1a; 
            padding: 20px; 
            overflow: hidden; 
            min-height: 80px; 
        }
        .ticker { 
            display: block; 
            text-align: center; 
            font-size: 2.2em; 
            transition: opacity 0.5s ease; 
            line-height: 1.4; 
            white-space: nowrap; 
            margin: 0; 
        }
        .ticker.fade { opacity: 0.3; }
        .ticker.active { opacity: 1; }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="video-container">
            <video id="isl-video" muted playsinline></video>
        </div>
    </div>
    <div class="ticker-wrap">
        <div id="ticker" class="ticker"></div>
    </div>
    <audio id="announcement-audio"></audio>
    <audio id="intro-audio" preload="auto"></audio>

    <script>
        const videoElement = document.getElementById('isl-video');
        const audioPlayer = document.getElementById('announcement-audio');
        const introAudio = document.getElementById('intro-audio');
        const tickerElement = document.getElementById('ticker');
        
        const videoPlaylist = ["/multi_language_isl/announcements/1753863115310_announcement/isl_video.mp4"];
        const audioPlaylist = ["/multi_language_isl/announcements/1753863115310_announcement/audio/en_audio.wav","/multi_language_isl/announcements/1753863115310_announcement/audio/hi_audio.wav","/multi_language_isl/announcements/1753863115310_announcement/audio/mr_audio.wav","/multi_language_isl/announcements/1753863115310_announcement/audio/gu_audio.wav"];
        const announcementData = [{"language_code":"en","text":"train number 112","audio_path":"/multi_language_isl/announcements/1753863115310_announcement/audio/en_audio.wav"},{"language_code":"hi","text":"train number 112","audio_path":"/multi_language_isl/announcements/1753863115310_announcement/audio/hi_audio.wav"},{"language_code":"mr","text":"train number 112","audio_path":"/multi_language_isl/announcements/1753863115310_announcement/audio/mr_audio.wav"},{"language_code":"gu","text":"train number 112","audio_path":"/multi_language_isl/announcements/1753863115310_announcement/audio/gu_audio.wav"}];
        
        const introAudioPath = window.location.origin + '/audio/intro_audio/intro.wav';
        let currentAudioIndex = 0;
        let isPlaying = false;
        let isPlayingIntro = false;

        // Set up intro audio
        introAudio.src = introAudioPath;
        introAudio.volume = 1.0;

        function updateTickerText(languageCode) {
            const announcement = announcementData.find(a => a.language_code === languageCode);
            if (announcement && tickerElement) {
                tickerElement.textContent = announcement.text;
                tickerElement.classList.add('active');
                tickerElement.classList.remove('fade');
            }
        }

        function fadeTickerText() {
            if (tickerElement) {
                tickerElement.classList.add('fade');
                tickerElement.classList.remove('active');
            }
        }

        function playIntroThenAnnouncement() {
            if (!audioPlayer || audioPlaylist.length === 0) return;
            
            isPlayingIntro = true;
            fadeTickerText();
            
            introAudio.onended = () => {
                isPlayingIntro = false;
                audioPlayer.src = audioPlaylist[currentAudioIndex];
                
                const currentAnnouncement = announcementData[currentAudioIndex];
                if (currentAnnouncement) {
                    updateTickerText(currentAnnouncement.language_code);
                }
                
                audioPlayer.play().catch(e => console.error("Audio play error:", e));
                currentAudioIndex++;
            };
            
            introAudio.play().catch(e => console.error("Intro audio play error:", e));
        }
        
        function startPlayback() {
            if (videoPlaylist.length > 0) {
                videoElement.src = videoPlaylist[0];
                videoElement.loop = true;
                videoElement.play().catch(e => console.error("Video play error:", e));
            }
            if (audioPlaylist.length > 0) {
                isPlaying = true;
                if (announcementData.length > 0) {
                    updateTickerText(announcementData[0].language_code);
                }
                playIntroThenAnnouncement();
            }
        }

        audioPlayer.addEventListener('ended', () => {
            if (isPlaying && currentAudioIndex < audioPlaylist.length) {
                playIntroThenAnnouncement();
            } else if (isPlaying) {
                currentAudioIndex = 0;
                setTimeout(() => {
                    if (isPlaying) {
                        playIntroThenAnnouncement();
                    }
                }, 1000);
            }
        });
        
        window.addEventListener('load', startPlayback, { once: true });
    </script>
</body>
</html>